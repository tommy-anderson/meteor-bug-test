FROM /Layerfiles/base-application
RUN echo "{}" > /root/app/.meteor/local/resolver-result-cache.json
CACHE /root/app/.meteor/local/resolver-result-cache.json
CACHE /root/app/.meteor/local/plugin-cache
CACHE /root/app/.meteor/local/isopacks
CACHE /root/app/.meteor/local/bundler-cache/scanner
CACHE /root/app/.meteor/local/bundler-cache/linker
WORKDIR /root/app
CHECKPOINT disabled
RUN tree -L 3 .meteor
RUN cat /root/app/.meteor/local/resolver-result-cache.json
RUN NODE_OPTIONS=--max_old_space_size=1024 meteor npm run start-dev
ENV BUILD_DIR=/root/build1
# IF RUN REPEATABLE IS THE ONLY CHECKPOINT IN THE RUN, IT DOESN'T REGISTER AS A CHECKPOINT
RUN time meteor build --directory $BUILD_DIR