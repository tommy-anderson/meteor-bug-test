FROM vm/ubuntu:18.04
RUN echo hi
SKIP REMAINING IF API_EXTRA=~ ^$
CACHE /root/server/.meteor/local/plugin-cache
COPY / /root/app
WORKDIR /root/app
RUN sudo apt-get update
RUN sudo apt-get install tree
RUN bash ./install-meteor.bash
ENV METEOR_ALLOW_SUPERUSER=true
RUN meteor npm install
#meteor is used only for preview links, so no need for it if no PRs
RUN pkill node; cp -r ./ /root/server/ && tree -L 2 /root/server/.meteor/local && cd /root/server && ls && nohup meteor npm run start-dev & meteor npm run wait-on-dev
RUN true
CHECKPOINT
RUN true
CHECKPOINT disabled
#Show contents after the app has run
RUN tree -L 2 /root/server/.meteor/local